import{a1 as h,a as V,M as f,J as x,D as E,C as _,e as y,o as N,k as l,l as n,s as p,v as O,x as U,z as I,H as $,y as R,B,q as C,p as F,I as S}from"./index-CiK7xBkD.js";import{E as q}from"./el-card-9u0QYif0.js";import{E as M}from"./el-input-number-Cib2fQjk.js";const z=b=>h.post("/config",b).then(d=>d.data),A={class:"page"},j=V({__name:"SetView",setup(b){const d=f({record_message:!0,scheduler:!0,echo:!0,inspect:!0,auto_reload:!0,commands:!0,help:!0}),a=f({basic:{network:[{type:"ws",host:"127.0.0.1",port:7777,token:"35c65152638a93de"}],ignore_self_message:!0,log:{level:"INFO",ignores:[],save:{enable:!1,rotation:"00:00",compression:"zip",colorize:!1}},prefix:["/"],skip_req_missing:!1,cmd_count:4096,external_dirs:[]},plugins:{$files:"",$prelude:"",record_message:{record_send:!0},auto_reload:{watch_dirs:"",watch_config:!0},echo:{},commands:{need_notice_me:!0,need_reply_me:!1,use_config_prefix:!0},help:{help_command:"help",help_alias:"帮助,命令帮助",page_size:10},database:{type:"sqlite",name:"database.db",driver:"aiosqlite"},server:{host:"127.0.0.1",port:5140,adapters:[{$path:"nekobox.main:NekoBoxAdapter",uin:2507078797,sign_url:"https://sign.lagrangecore.org/api/sign/30366",protocol:"remote",log_level:"INFO",use_png:!1}]},webui:{}}});x(async()=>{try{const e=(await E.get(window.RUNTIME_CONFIG?.baseURL+"/config")).data,r={};for(const[u,i]of Object.entries(e.plugins)){const s=u.replace(/^[~.:]+/,"");r[s]=i}Object.assign(a.basic,e.basic),Object.assign(a.plugins,r)}catch(o){_.error("加载配置失败，请检查后端服务是否正常"),console.error("加载配置失败",o)}});const w=async()=>{const o=JSON.parse(JSON.stringify(a));o.plugins.server.adapters.forEach(s=>{s.sign_url&&(s.sign_url=s.sign_url.trim())});const e={basic:{network:o.basic.network,ignore_self_message:o.basic.ignore_self_message,prefix:o.basic.prefix,log:{level:o.basic.log.level}},plugins:{}};o.basic.log.ignores?.length&&(e.basic.log.ignores=o.basic.log.ignores),o.basic.log.save?.enable&&(e.basic.log.save=o.basic.log.save);const r=["database","server","webui"],u=["record_message","scheduler","echo","inspect","auto_reload","commands","help","database","server","webui"],i={record_message:".",scheduler:".",echo:"::",inspect:"::",auto_reload:"::",commands:".",help:"::"};for(const s of u){const c=i[s]??"",m=d[s]??!0?`${c}${s}`:`~${s}`;e.plugins[m]=o.plugins[s]??{}}for(const s of r)s in o.plugins&&(e.plugins[s]=o.plugins[s]);o.plugins.$files&&(e.plugins.$files=o.plugins.$files),o.plugins.$prelude&&(e.plugins.$prelude=o.plugins.$prelude);try{await z(e),_.success("已保存")}catch(s){console.error("保存失败",s),_.error("保存失败")}};return(o,e)=>{const r=$,u=I,i=U,s=R,c=M,g=B,m=O,k=C,v=q;return N(),y("div",A,[l(v,{shadow:"never",class:"card"},{header:n(()=>e[8]||(e[8]=[p("h1",null,"系统设置",-1),p("p",null,"一站式管理 Entari WebUI 与后端参数",-1)])),default:n(()=>[p("section",null,[e[9]||(e[9]=p("h2",null,"基础配置:",-1)),l(m,{"label-width":"120px",style:{"max-width":"480px"}},{default:n(()=>[l(i,{label:"类型"},{default:n(()=>[l(u,{modelValue:a.basic.network[0].type,"onUpdate:modelValue":e[0]||(e[0]=t=>a.basic.network[0].type=t),placeholder:"选择网络类型"},{default:n(()=>[l(r,{label:"ws",value:"ws"}),l(r,{label:"websocket",value:"websocket"}),l(r,{label:"wh",value:"wh"}),l(r,{label:"webhook",value:"webhook"})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"服务器地址"},{default:n(()=>[l(s,{modelValue:a.basic.network[0].host,"onUpdate:modelValue":e[1]||(e[1]=t=>a.basic.network[0].host=t),placeholder:"satori 服务器地址"},null,8,["modelValue"])]),_:1}),l(i,{label:"端口"},{default:n(()=>[l(c,{modelValue:a.basic.network[0].port,"onUpdate:modelValue":e[2]||(e[2]=t=>a.basic.network[0].port=t),min:1,max:65535},null,8,["modelValue"])]),_:1}),l(i,{label:"路径"},{default:n(()=>[l(s,{modelValue:a.basic.network[0].path,"onUpdate:modelValue":e[3]||(e[3]=t=>a.basic.network[0].path=t),placeholder:"satori 服务器路径(默认为空)"},null,8,["modelValue"])]),_:1}),l(i,{label:"token"},{default:n(()=>[l(s,{modelValue:a.basic.network[0].token,"onUpdate:modelValue":e[4]||(e[4]=t=>a.basic.network[0].token=t),placeholder:"账号配置文件的token"},null,8,["modelValue"])]),_:1}),l(i,{label:"忽略自身消息"},{default:n(()=>[l(g,{modelValue:a.basic.ignore_self_message,"onUpdate:modelValue":e[5]||(e[5]=t=>a.basic.ignore_self_message=t)},null,8,["modelValue"])]),_:1}),l(i,{label:"日志等级"},{default:n(()=>[l(u,{modelValue:a.basic.log.level,"onUpdate:modelValue":e[6]||(e[6]=t=>a.basic.log.level=t),placeholder:"选择日志等级",style:{width:"240px"}},{default:n(()=>[l(r,{label:"DEBUG",value:"DEBUG"}),l(r,{label:"INFO",value:"INFO"}),l(r,{label:"WARN",value:"WARN"}),l(r,{label:"ERROR",value:"ERROR"})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"指令前缀"},{default:n(()=>[l(u,{modelValue:a.basic.prefix,"onUpdate:modelValue":e[7]||(e[7]=t=>a.basic.prefix=t),multiple:"","allow-create":"",filterable:"",placeholder:"可留空，默认为 /",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),l(k,{class:"save",onClick:w,type:"primary"},{default:n(()=>e[10]||(e[10]=[F("保存配置")])),_:1,__:[10]})]),_:1})])}}}),W=S(j,[["__scopeId","data-v-bea162d7"]]);export{W as default};
