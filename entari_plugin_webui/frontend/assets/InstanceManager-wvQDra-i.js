import{i as C,M,N as ve,a as ee,O as pe,P as _e,Q as B,l as i,R as te,k as u,S as be,T as ye,U as R,V as xe,L as ne,W as le,X as N,Y as K,Z as ae,$ as Ce,a0 as ke,a1 as V,J as we,e as j,o as $,E as Ie,G as q,m as $e,p as _,t as z,s as E,a2 as Ee,f as Q,q as Ve,a3 as Le,g as Se,a4 as Be,v as Ne,x as Ae,y as Te,C as w,a5 as Je,I as he}from"./index-CiK7xBkD.js";import{E as Oe}from"./el-card-9u0QYif0.js";import{a as ze,E as Pe}from"./el-table-column-CYdOAsOl.js";function Me(e,t){let l;const c=C(!1),a=M({...e,originalPosition:"",originalOverflow:"",visible:!1});function d(o){a.text=o}function v(){const o=a.parent,y=g.ns;if(!o.vLoadingAddClassList){let p=o.getAttribute("loading-number");p=Number.parseInt(p)-1,p?o.setAttribute("loading-number",p.toString()):(R(o,y.bm("parent","relative")),o.removeAttribute("loading-number")),R(o,y.bm("parent","hidden"))}f(),b.unmount()}function f(){var o,y;(y=(o=g.$el)==null?void 0:o.parentNode)==null||y.removeChild(g.$el)}function L(){var o;e.beforeClose&&!e.beforeClose()||(c.value=!0,clearTimeout(l),l=setTimeout(m,400),a.visible=!1,(o=e.closed)==null||o.call(e))}function m(){if(!c.value)return;const o=a.parent;c.value=!1,o.vLoadingAddClassList=void 0,v()}const k=ee({name:"ElLoading",setup(o,{expose:y}){const{ns:p,zIndex:U}=_e("loading");return y({ns:p,zIndex:U}),()=>{const T=a.spinner||a.svg,D=B("svg",{class:"circular",viewBox:a.svgViewBox?a.svgViewBox:"0 0 50 50",...T?{innerHTML:T}:{}},[B("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),F=a.text?B("p",{class:p.b("text")},[a.text]):void 0;return B(ye,{name:p.b("fade"),onAfterLeave:m},{default:i(()=>[te(u("div",{style:{backgroundColor:a.background||""},class:[p.b("mask"),a.customClass,a.fullscreen?"is-fullscreen":""]},[B("div",{class:p.b("spinner")},[D,F])]),[[be,a.visible]])])})}}}),b=ve(k);Object.assign(b._context,t??{});const g=b.mount(document.createElement("div"));return{...pe(a),setText:d,removeElLoadingChild:f,close:L,handleAfterLeave:m,vm:g,get $el(){return g.$el}}}let P;const G=function(e={}){if(!xe)return;const t=Re(e);if(t.fullscreen&&P)return P;const l=Me({...t,closed:()=>{var a;(a=t.closed)==null||a.call(t),t.fullscreen&&(P=void 0)}},G._context);Ue(t,t.parent,l),W(t,t.parent,l),t.parent.vLoadingAddClassList=()=>W(t,t.parent,l);let c=t.parent.getAttribute("loading-number");return c?c=`${Number.parseInt(c)+1}`:c="1",t.parent.setAttribute("loading-number",c),t.parent.appendChild(l.$el),ne(()=>l.visible.value=t.visible),t.fullscreen&&(P=l),l},Re=e=>{var t,l,c,a;let d;return le(e.target)?d=(t=document.querySelector(e.target))!=null?t:document.body:d=e.target||document.body,{parent:d===document.body||e.body?document.body:d,background:e.background||"",svg:e.svg||"",svgViewBox:e.svgViewBox||"",spinner:e.spinner||!1,text:e.text||"",fullscreen:d===document.body&&((l=e.fullscreen)!=null?l:!0),lock:(c=e.lock)!=null?c:!1,customClass:e.customClass||"",visible:(a=e.visible)!=null?a:!0,beforeClose:e.beforeClose,closed:e.closed,target:d}},Ue=async(e,t,l)=>{const{nextZIndex:c}=l.vm.zIndex||l.vm._.exposed.zIndex,a={};if(e.fullscreen)l.originalPosition.value=N(document.body,"position"),l.originalOverflow.value=N(document.body,"overflow"),a.zIndex=c();else if(e.parent===document.body){l.originalPosition.value=N(document.body,"position"),await ne();for(const d of["top","left"]){const v=d==="top"?"scrollTop":"scrollLeft";a[d]=`${e.target.getBoundingClientRect()[d]+document.body[v]+document.documentElement[v]-Number.parseInt(N(document.body,`margin-${d}`),10)}px`}for(const d of["height","width"])a[d]=`${e.target.getBoundingClientRect()[d]}px`}else l.originalPosition.value=N(t,"position");for(const[d,v]of Object.entries(a))l.$el.style[d]=v},W=(e,t,l)=>{const c=l.vm.ns||l.vm._.exposed.ns;["absolute","fixed","sticky"].includes(l.originalPosition.value)?R(t,c.bm("parent","relative")):K(t,c.bm("parent","relative")),e.fullscreen&&e.lock?K(t,c.bm("parent","hidden")):R(t,c.bm("parent","hidden"))};G._context=null;const A=Symbol("ElLoading"),I=e=>`element-loading-${ke(e)}`,X=(e,t)=>{var l,c,a,d;const v=t.instance,f=o=>ae(t.value)?t.value[o]:void 0,L=o=>{const y=le(o)&&v?.[o]||o;return C(y)},m=o=>L(f(o)||e.getAttribute(I(o))),k=(l=f("fullscreen"))!=null?l:t.modifiers.fullscreen,b={text:m("text"),svg:m("svg"),svgViewBox:m("svgViewBox"),spinner:m("spinner"),background:m("background"),customClass:m("customClass"),fullscreen:k,target:(c=f("target"))!=null?c:k?void 0:e,body:(a=f("body"))!=null?a:t.modifiers.body,lock:(d=f("lock"))!=null?d:t.modifiers.lock},g=G(b);g._context=Y._context,e[A]={options:b,instance:g}},De=(e,t)=>{for(const l of Object.keys(e))Ce(e[l])&&(e[l].value=t[l])},Y={mounted(e,t){t.value&&X(e,t)},updated(e,t){const l=e[A];if(!t.value){l?.instance.close(),e[A]=null;return}l?De(l.options,ae(t.value)?t.value:{text:e.getAttribute(I("text")),svg:e.getAttribute(I("svg")),svgViewBox:e.getAttribute(I("svgViewBox")),spinner:e.getAttribute(I("spinner")),background:e.getAttribute(I("background")),customClass:e.getAttribute(I("customClass"))}):X(e,t)},unmounted(e){var t;(t=e[A])==null||t.instance.close(),e[A]=null}};Y._context=null;const Fe=()=>V.get("/api/instances").then(e=>e.data),je=e=>V.post("/api/instances",e),qe=e=>V.post(`/api/instances/${e}/start`),Ge=e=>V.post(`/api/instances/${e}/stop`),Ye=e=>V.delete(`/api/instances/${e}`),Ze=(e,t)=>V.put(`/api/instances/${e}/config`,t),He={class:"instance-manager"},Ke={class:"header-content"},Qe={key:0},We={key:1,class:"text-gray-400"},Xe=ee({__name:"InstanceManager",setup(e){const t=C([]),l=C(!1),c=M({}),a=C(!1),d=C(!1),v=C(),f=M({name:"",configJson:""}),L={name:[{required:!0,message:"请输入实例名称",trigger:"blur"},{min:2,max:50,message:"实例名称长度在 2 到 50 个字符",trigger:"blur"}]},m=C(!1),k=C(!1),b=C(null),g=M({configJson:""});async function o(){l.value=!0;try{t.value=await Fe()}catch(r){console.error("获取实例列表失败:",r)}finally{l.value=!1}}async function y(){if(await v.value?.validate()){d.value=!0;try{let n;f.configJson.trim()&&(n=JSON.parse(f.configJson)),await je({name:f.name,config:n}),w.success("实例创建成功"),a.value=!1,f.name="",f.configJson="",o()}catch(n){console.error("创建实例失败:",n),n instanceof SyntaxError&&w.error("配置JSON格式错误")}finally{d.value=!1}}}async function p(r){c[r]=!0;try{await qe(r),w.success("实例启动成功"),o()}catch(n){console.error("启动实例失败:",n)}finally{c[r]=!1}}async function U(r){c[r]=!0;try{await Ge(r),w.success("实例停止成功"),o()}catch(n){console.error("停止实例失败:",n)}finally{c[r]=!1}}async function T(r){try{await Je.confirm(`确定要删除实例 "${r.name}" 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await Ye(r.id),w.success("实例删除成功"),o()}catch(n){n!=="cancel"&&console.error("删除实例失败:",n)}}function D(r){b.value=r,g.configJson=JSON.stringify(r.config||{},null,2),m.value=!0}async function F(){if(b.value){k.value=!0;try{const r=JSON.parse(g.configJson);await Ze(b.value.id,r),w.success("配置更新成功"),m.value=!1,o()}catch(r){console.error("更新配置失败:",r),r instanceof SyntaxError&&w.error("配置JSON格式错误")}finally{k.value=!1}}}function oe(r){w.info(`查看实例 ${r.name} 的日志`)}function se(r){return{running:"success",stopped:"info",starting:"warning",stopping:"warning"}[r]||"info"}function re(r){return{running:"运行中",stopped:"已停止",starting:"启动中",stopping:"停止中"}[r]||r}function ie(r){return new Date(r).toLocaleString()}return we(()=>{o()}),(r,n)=>{const ue=Le,x=Ve,S=ze,ce=$e,de=Ee,fe=Pe,me=Oe,J=Te,h=Ae,Z=Ne,H=Ie,ge=Y;return $(),j("div",He,[u(me,{shadow:"hover"},{header:i(()=>[E("div",Ke,[n[9]||(n[9]=E("div",null,[E("h1",null,"实例管理"),E("p",null,"管理 Entari 实例的创建、启动和配置")],-1)),u(x,{type:"primary",onClick:n[0]||(n[0]=s=>a.value=!0)},{default:i(()=>[u(ue,null,{default:i(()=>[u(Se(Be))]),_:1}),n[8]||(n[8]=_(" 创建实例 "))]),_:1,__:[8]})])]),default:i(()=>[te(($(),q(fe,{data:t.value,style:{width:"100%"}},{default:i(()=>[u(S,{prop:"name",label:"实例名称","min-width":"150"}),u(S,{prop:"status",label:"状态",width:"120"},{default:i(({row:s})=>[u(ce,{type:se(s.state)},{default:i(()=>[_(z(re(s.state)),1)]),_:2},1032,["type"])]),_:1}),u(S,{prop:"created_at",label:"创建时间",width:"180"},{default:i(({row:s})=>[_(z(ie(s.created_at)),1)]),_:1}),u(S,{label:"资源使用",width:"200"},{default:i(({row:s})=>[s.stats?($(),j("div",Qe,[E("div",null,"CPU: "+z(s.stats.cpu)+"%",1),E("div",null,"内存: "+z(s.stats.memory)+"MB",1)])):($(),j("span",We,"-"))]),_:1}),u(S,{label:"操作",width:"300"},{default:i(({row:s})=>[u(de,null,{default:i(()=>[s.status==="stopped"?($(),q(x,{key:0,size:"small",type:"success",onClick:O=>p(s.id),loading:c[s.id]},{default:i(()=>n[10]||(n[10]=[_(" 启动 ")])),_:2,__:[10]},1032,["onClick","loading"])):Q("",!0),s.status==="running"?($(),q(x,{key:1,size:"small",type:"warning",onClick:O=>U(s.id),loading:c[s.id]},{default:i(()=>n[11]||(n[11]=[_(" 停止 ")])),_:2,__:[11]},1032,["onClick","loading"])):Q("",!0),u(x,{size:"small",onClick:O=>D(s)},{default:i(()=>n[12]||(n[12]=[_(" 配置 ")])),_:2,__:[12]},1032,["onClick"]),u(x,{size:"small",onClick:O=>oe(s)},{default:i(()=>n[13]||(n[13]=[_(" 日志 ")])),_:2,__:[13]},1032,["onClick"]),u(x,{size:"small",type:"danger",onClick:O=>T(s),disabled:s.status==="running"},{default:i(()=>n[14]||(n[14]=[_(" 删除 ")])),_:2,__:[14]},1032,["onClick","disabled"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ge,l.value]])]),_:1}),u(H,{modelValue:a.value,"onUpdate:modelValue":n[4]||(n[4]=s=>a.value=s),title:"创建新实例",width:"500"},{footer:i(()=>[u(x,{onClick:n[3]||(n[3]=s=>a.value=!1)},{default:i(()=>n[15]||(n[15]=[_("取消")])),_:1,__:[15]}),u(x,{type:"primary",onClick:y,loading:d.value},{default:i(()=>n[16]||(n[16]=[_(" 创建 ")])),_:1,__:[16]},8,["loading"])]),default:i(()=>[u(Z,{model:f,rules:L,ref_key:"createFormRef",ref:v,"label-width":"100"},{default:i(()=>[u(h,{label:"实例名称",prop:"name"},{default:i(()=>[u(J,{modelValue:f.name,"onUpdate:modelValue":n[1]||(n[1]=s=>f.name=s),placeholder:"请输入实例名称"},null,8,["modelValue"])]),_:1}),u(h,{label:"配置",prop:"config"},{default:i(()=>[u(J,{modelValue:f.configJson,"onUpdate:modelValue":n[2]||(n[2]=s=>f.configJson=s),type:"textarea",rows:6,placeholder:"请输入JSON格式的配置（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),u(H,{modelValue:m.value,"onUpdate:modelValue":n[7]||(n[7]=s=>m.value=s),title:"实例配置",width:"600"},{footer:i(()=>[u(x,{onClick:n[6]||(n[6]=s=>m.value=!1)},{default:i(()=>n[17]||(n[17]=[_("取消")])),_:1,__:[17]}),u(x,{type:"primary",onClick:F,loading:k.value},{default:i(()=>n[18]||(n[18]=[_(" 保存配置 ")])),_:1,__:[18]},8,["loading"])]),default:i(()=>[u(Z,{model:g,"label-width":"100"},{default:i(()=>[u(h,{label:"实例名称"},{default:i(()=>[u(J,{value:b.value?.name,disabled:""},null,8,["value"])]),_:1}),u(h,{label:"配置"},{default:i(()=>[u(J,{modelValue:g.configJson,"onUpdate:modelValue":n[5]||(n[5]=s=>g.configJson=s),type:"textarea",rows:8,placeholder:"请输入JSON格式的配置"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),lt=he(Xe,[["__scopeId","data-v-c5559dc2"]]);export{lt as default};
